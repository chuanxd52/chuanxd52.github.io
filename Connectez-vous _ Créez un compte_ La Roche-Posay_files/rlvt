!function(){"use strict";var e,t=function(){return(t=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)},n=function(e,t){var n="000000000"+e;return n.substr(n.length-t)},r="object"==typeof window?window:self,i=Object.keys(r).length,o=navigator.mimeTypes?navigator.mimeTypes.length:0,a=n((o+navigator.userAgent.length).toString(36)+i.toString(36),4),s=function(){return a},l="undefined"!=typeof window&&(window.crypto||window.msCrypto)||"undefined"!=typeof self&&self.crypto;if(l){var u=Math.pow(2,32)-1;e=function(){return Math.abs(l.getRandomValues(new Uint32Array(1))[0]/u)}}else e=Math.random;var d=e,c=0,f=Math.pow(36,4);function v(){return n((d()*f<<0).toString(36),4)}function p(){return c=c<f?c:0,++c-1}function h(){return"c"+(new Date).getTime().toString(36)+n(p().toString(36),4)+s()+(v()+v())}h.slug=function(){var e=(new Date).getTime().toString(36),t=p().toString(36).slice(-4),n=s().slice(0,1)+s().slice(-1),r=v().slice(-2);return e.slice(-2)+t+n+r},h.isCuid=function(e){return"string"==typeof e&&!!e.startsWith("c")},h.isSlug=function(e){if("string"!=typeof e)return!1;var t=e.length;return t>=7&&t<=10},h.fingerprint=s;var y=h;var g,m=(function(e,t){var n;n=function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function i(){}function o(t,n,o){if("undefined"!=typeof document){"number"==typeof(o=e({path:"/"},i.defaults,o)).expires&&(o.expires=new Date(1*new Date+864e5*o.expires)),o.expires=o.expires?o.expires.toUTCString():"";try{var a=JSON.stringify(n);/^[\{\[]/.test(a)&&(n=a)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var s="";for(var l in o)o[l]&&(s+="; "+l,!0!==o[l]&&(s+="="+o[l].split(";")[0]));return document.cookie=t+"="+n+s}}function a(e,n){if("undefined"!=typeof document){for(var i={},o=document.cookie?document.cookie.split("; "):[],a=0;a<o.length;a++){var s=o[a].split("="),l=s.slice(1).join("=");n||'"'!==l.charAt(0)||(l=l.slice(1,-1));try{var u=t(s[0]);if(l=(r.read||r)(l,u)||t(l),n)try{l=JSON.parse(l)}catch(e){}if(i[u]=l,e===u)break}catch(e){}}return e?i[e]:i}}return i.set=o,i.get=function(e){return a(e,!1)},i.getJSON=function(e){return a(e,!0)},i.remove=function(t,n){o(t,"",e(n,{expires:-1}))},i.defaults={},i.withConverter=n,i}((function(){}))},e.exports=n()}(g={exports:{}},g.exports),g.exports),w="rlvt_tmpId",I="rlvt_id",b="rlvt_clientId",S="rlvt_b",A="rlvt_fail_queue",R=["undefined","null","inconnu","unknown","0","-1","NaN","ko","true","false","Infinity","-Infinity","{}","[]"],U=["class","style","id","rlvt","workflow","entrypoint"],C=function(){function e(e,t,n,r){var i=this;this.companyId=e,this.domain=t,this.currentUrl=n,this.destinationUrl=r,this.wellKnowns={},this.initUser(),this.initSourceIdentifier(),this.startEmptyingFailQueue(),document.addEventListener("load",(function(){setTimeout((function(){i.loadZones()}))})),"object"==typeof window.ABTasty&&(window.addEventListener("abtasty_executedCampaign",(function(){setTimeout((function(){i.loadZones()}))})),setTimeout((function(){i.loadZones()}))),this.loadZones(),this.dataLayerVariables=this.parseDataLayers(),this.wellKnowns=this.findWellknowns()}return e.prototype.event=function(e,t){var n=this,r=t;"page_view"!==e&&setTimeout((function(){if("identify"===e){if(!1===n.isClientIdValid(t))return;var i=n.user.clientId===String(r);if(n.storeClientId(String(r)),i)return;r={}}var o=n.buildEvent(e,r);if(null!==o)return n.sendEvent(o)}))},e.prototype.identify=function(e){return!1===this.isClientIdValid(e)?console.error("Reelevant error: Failed to publish identify: clientId is empty",{clientId:e}):this.event("identify",e)},e.prototype.storeClientId=function(e){this.user.clientId=String(e),m.set(b,this.user.clientId,{domain:this.domain})},e.prototype.isClientIdValid=function(e){return"number"==typeof e&&(e=String(e)),"string"==typeof e&&0!==e.length&&R.every((function(t){return e!==t}))},e.prototype.initUser=function(){var e,t=m.get(w);this.user={tmpId:null!=t?t:y()},void 0===t&&m.set(w,this.user.tmpId,{domain:this.domain});var n=new URLSearchParams(this.currentUrl.search);this.user.rlvtId=null!==(e=n.get(I))&&void 0!==e?e:m.get(I),this.user.rlvtId&&m.set(I,this.user.rlvtId,{expires:30,domain:this.domain});var r=m.get(b);this.isClientIdValid(r)&&(this.user.clientId=m.get(b));var i=window.reelevant_user;this.isClientIdValid(i)&&this.storeClientId(i);var o=n.get("rlvt-u")||n.get("rlvt_u")||n.get("clientUid");this.isClientIdValid(o)&&this.storeClientId(o);var a=this.currentUrl.hash?this.currentUrl.hash.match(/rlvt-u=([a-zA-Z0-9@.]{1,})/):null;null!==a&&this.isClientIdValid(a[1])&&this.storeClientId(a[1])},e.prototype.initSourceIdentifier=function(){var e=new URLSearchParams(this.currentUrl.search).get(S);this.sourceIdentifier=null!=e?e:m.get(S),e&&m.set(S,this.sourceIdentifier,{domain:this.domain})},e.prototype.buildEvent=function(e,t){if(void 0===t&&(t={}),!e)return console.error("Reelevant error: Name is required to send event"),null;if("object"!=typeof t||null===t||Array.isArray(t))return console.error("Reelevant error: Data must be an object",{data:t,name:e}),null;var n;try{n=JSON.parse(JSON.stringify(t))}catch(n){return console.error("Reelevant error: Unable to build data",{data:t,name:e}),null}if("string"!=typeof n.locale&&"string"==typeof this.wellKnowns.locale&&(n.locale=this.wellKnowns.locale),"string"!=typeof n.country&&"string"==typeof this.wellKnowns.country&&void 0===n.locale&&(n.country=this.wellKnowns.country),void 0!==n.ids&&"string"!=typeof n.ids&&!1===Array.isArray(n.ids))return console.error("Reelevant error: Unable to build data, ids must be a string or an array of strings",n),null;var r=Array.isArray(n.ids)?n.ids:"string"==typeof n.ids?[n.ids]:[],i=r.flat().map((function(e){return Array.isArray(e)?(console.warn("Reelevant warning: ids are nested in arrays",n),String(e[0])):String(e)})).map((function(t){var r=t.includes(";")?";":t.includes(",")?",":t.includes("|")?"|":void 0;return void 0!==r&&!1===["category_view","brand_view"].includes(e)?(console.warn("Reelevant warning: ids should be an array if you have more than 1 product id",n),t.split(r)):String(t)})).flat().filter((function(e){return e.length>0&&!1===R.includes(e)}));if(i.length>0&&(n.ids=i),r.length>0&&0===i.length)return console.error("Reelevant error: Unable to build data, ids must not be empty",n),null;if(void 0!==n.value&&"string"!=typeof n.value&&"number"!=typeof n.value)return console.error("Reelevant error: Unable to build data, value must be a string or a number",n),null;if("string"==typeof n.value&&(n.value.includes(";")||n.value.includes(",")||n.value.includes("|")))return console.warn("Reelevant warning: value should be the total value if you have multiple products",n),null;if(void 0!==n.value){var o=parseFloat(n.value);if(!0===Number.isNaN(o))return console.warn("Reelevant warning: value should be a valid number",n),null;n.value=o.toFixed(2)}return Array.isArray(n.ids)&&"string"==typeof n.ids[0]&&(n.ids=n.ids.map((function(e){var t=Number(e);return Number.isNaN(t)?e:t}))),{key:this.companyId,name:e,url:this.currentUrl.href,id:this.user.rlvtId,b:this.sourceIdentifier,tmpId:this.user.tmpId,clientId:this.user.rlvtId?void 0:this.user.clientId,data:n,eventId:y(),v:1}},e.prototype.sendEvent=function(e){var t=this,n=new XMLHttpRequest;n.open("POST",this.destinationUrl,!0),n.setRequestHeader("content-type","application/json"),n.send(JSON.stringify(e)),n.onerror=function(){t.addToFailQueue(e)},n.onload=function(){n.status>=500&&t.addToFailQueue(e)}},e.prototype.parseDataLayers=function(){var e=["dataLayer","tc_vars"];return Object.keys(window).filter((function(t){return e.some((function(e){return t.includes(e)}))})).reduce((function(e,t){var n=window[t];return Array.isArray(n)?Object.assign({},e,n.filter((function(e){return"object"==typeof e&&!1===Array.isArray(e)})).reduce((function(e,t){return Object.assign({},e,t)}),{})):"object"==typeof n&&null!==n?Object.assign({},e,n):e}),{})},e.prototype.findWellknowns=function(){for(var e={},t=0,n=Object.entries(this.dataLayerVariables);t<n.length;t++){var r=n[t],i=r[0],o=r[1];(i.includes("locale")||i.includes("language"))&&"string"==typeof o&&o.trim().length>0&&(e.locale=o),i.includes("country")&&"string"==typeof o&&o.trim().length>0&&(e.country=o)}return e},e.prototype.getFailQueue=function(){var e=localStorage.getItem(A);return null===e?[]:JSON.parse(e)},e.prototype.saveFailQueue=function(e){localStorage.setItem(A,JSON.stringify(e))},e.prototype.addToFailQueue=function(e){if(!(e.timestamp&&e.timestamp<=Date.now()-18e5)){var n=this.getFailQueue();n.push(t({timestamp:Date.now()},e)),this.saveFailQueue(n)}},e.prototype.startEmptyingFailQueue=function(){var e=this,t=function(){var t=e.getFailQueue(),n=t.shift();void 0!==n&&(e.saveFailQueue(t),e.sendEvent(n))};t(),setInterval(t,6e4)},e.prototype.loadZones=function(){for(var e=this,t=document.querySelectorAll("[rlvt]"),n=function(t){if(t.children.length>0)return"continue";var n=t.getAttributeNames().filter((function(e){return!1===U.includes(e)})),i=t.getAttribute("workflow");if(void 0===i)return"continue";var o=t.getAttribute("entrypoint")||"0",a=new URLSearchParams(r.currentUrl.search),s=n.reduce((function(t,n){var r,i=null!==(r=a.get(n))&&void 0!==r?r:e.dataLayerVariables[n];return"string"!=typeof i||0===i.trim().length||(t[n]=i.trim()),t}),{}),l=s["rlvt-u"]||r.user.clientId||r.user.tmpId;if(s["rlvt-u"]=l,void 0===l||0===l.length)return{value:void 0};var u=document.createElement("img"),d="https://reelevant.run/"+i+"/"+o+"?"+new URLSearchParams(s).toString();u.src=d;var c=document.createElement("a");c.href=d+"&mode=click",c.appendChild(u),t.appendChild(c)},r=this,i=0,o=Array.from(t);i<o.length;i++){var a=n(o[i]);if("object"==typeof a)return a.value}},e}();!function(e){var t,n;if(!(null===(t=e.reel)||void 0===t?void 0:t.companyId))return console.error("Reelevant error: Missing key");if(!(null===(n=e.reel)||void 0===n?void 0:n.datasourceId))return console.error("Reelevant error: Missing datasource");var r=e.location.host,i=r.split("."),o=[".co.uk"].includes(r.substr(r.length-6))?3:2,a=i.slice(i.length-o).join("."),s=new C(e.reel.companyId,"."+(["myshopify.com"].some((function(t){return e.location.host.includes(t)}))?e.location.host:a),e.location,"https://collector.reelevant.com/collect/{datasourceId}/rlvt".replace(/{datasourceId}/g,e.reel.datasourceId));e.reel.event=s.event.bind(s),e.reel.identify=s.identify.bind(s),e.reel.loadZones=s.loadZones.bind(s),e.reel.queue||(e.reel.queue=[]),setInterval((function(){var t,n,r=(null!==(n=null===(t=e.reel)||void 0===t?void 0:t.queue)&&void 0!==n?n:[]).shift();r&&s.event.apply(s,r)}),1e3)}(window)}();
